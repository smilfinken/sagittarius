#{extends "Competitions/main.html" /}
#{set title: "Resultat" /}

<hr />

#{if (competitors?.size() > 0)}
<div>
	<form id="competitor" method="POST">
		<input type="hidden" name="competitionID" value="${competition.id}" />
		<table>
			<tr>
				<td colspan="6">
					#{include "Common/selectCompetitor.html" /}
					<button class="delete" type="submit" formaction="@{Results.unregisterUser()}" formmethod="POST"  #{if (request.headers.get("user-agent").toString().contains("MSIE"))}onClick='document.getElementById("competitor").action="@{Results.unregisterUser()}"'#{/if}>&{'competitors.unregister'}</button>
				</td>
			</tr>
			<tr class="scoring">
				%{
				for (int i=0; i<competition.stages.size(); i++)
				{
				}%
				<td class="scoring">
					<div style="text-align: center; clear: all">Station ${i+1}</div>
					<label for="results[${i}].hits">Tr&auml;ff</label>
					<input class="scoring" type="text" size="2" maxlength="1" name="results[${i}].hits" /><br />
					<label for="results[${i}].targets">Figurer</label>
					<input class="scoring" type="text" size="2" maxlength="1" name="results[${i}].targets" /><br />
					%{
					if (competition.stages[i].hasPoints()) {
					}%
					<label for="results[${i}].points">&{'competitions.points'}</label>
					<input class="scoring" type="text" size="2" maxlength="2" name="results[${i}].points" /><br />
					%{
					}
					}%
				</td>
				%{
				}
				}%
				</tr>
				<tr>
					<td class="buttons" colspan="7">
						<button class="enter" type="submit" formaction="@{Results.add()}" formmethod="POST" #{if (request.headers.get("user-agent").toString().contains("MSIE"))}onClick='document.getElementById("competitor").action="@{Results.add()}"'#{/if}>&{'results.register'}</button>
					</td>
				</tr>
		</table>
	</form>
</div>
#{/if}
#{else}
<div>
	&{'competitors.nocompetitors'}
</div>
#{/else}

<hr />

#{if (results?.size() > 0)}
<div>
	<table>
		<tr>
			<td>
				<form id="export" method="POST">
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<button formtarget="_blank" class="enter" type="submit" formaction="@{Results.generatePDF()}"  #{if (request.headers.get("user-agent").toString().contains("MSIE"))}onClick='document.getElementById("export").action="@{Results.generatePDF()}"; document.getElementById("export").target="_blank"'#{/if}>&{'export.print'}</button>
					<button class="enter" type="submit" formaction="@{Results.export()}" #{if (request.headers.get("user-agent").toString().contains("MSIE"))}onClick='document.getElementById("export").action="@{Results.export()}"'#{/if}>&{'export'}</button>
					<button class="enter" type="submit" formaction="@{Results.exportToShooter()}" #{if (request.headers.get("user-agent").toString().contains("MSIE"))}onClick='document.getElementById("export").action="@{Results.exportToShooter()}"'#{/if}>&{'export.integration'}</button>
				</form>
			</td>
		</tr>
	</table>
</div>

<hr />

<div>
	%{
	int totalHits;
	int totalTargets;
	int totalPoints;
	int place = 1;
	}%
	<table>
		<tr>
			<th colspan="2" style="text-align: left">&{'common.name'}</th>
			<th>&{'common.division'}</th>
			<th colspan="4">&{'results.title'}</th>
		</tr>
		%{
		if (results.size() > 0) {
		String previousClass = results.first().getDivision();
		for(entry in results){
		if (entry.results != null && entry.results.size() == competition.stages.size()) {
		if (!entry.getDivision().equals(previousClass)){
		place = 1;
		}%
		<tr><td colspan="4">&nbsp;</td></tr>
		%{
		}
		previousClass = entry.getDivision();
		}%
		<tr>
			<td style="font-style: italic; font-weight: bold; text-align: left">${place}</td>
			<td style="font-weight: bold">${entry.getFullName()}</td>
			<td style="font-weight: bold">${entry.getDivision()}</td>
			<td>
				%{
				totalHits = 0;
				totalTargets = 0;
				totalPoints = 0;
				for(result in entry.results){
				totalHits += result.hits;
				totalTargets += result.targets;
				}%
				${result.hits}/${result.targets}&nbsp;
				%{
				if (result.points > 0){
				totalPoints += result.points;
				}%
				(${result.points})&nbsp;
				%{
				}
				}
				}%
			</td>
			<td>
				${totalHits}/${totalTargets}
			</td>
			<td style="font-weight: bold">
				${totalHits + totalTargets}&nbsp;(${totalPoints})
			</td>
			<td>
				<form action="@{Results.delete()}" method="POST">
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="competitorID" value="${entry.id}" />
					<button class="delete" type="submit">&{'common.delete'}</button>
				</form>
			</td>
		</tr>
		%{
		place++;
		}
		}
		}
		}%
	</table>
</div>
#{/if}
#{else}
<div>
	&{'results.noresults'}
</div>
#{/else}