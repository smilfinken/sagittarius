#{extends "main.html" /}
#{set title: "${competition.name}, station ${stageIndex}" /}

%{
int i = 1;
int j = 1;
%}

<div>
	<h2>${competition.name}, &{'competitions.stage'} ${stageIndex}</h2>
	<form action="@{Stages.update}" method="POST">
		<table>
			<tr>
				<td>
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="stageID" value="${stage.id}" />
					<input type="hidden" name="stageIndex" value="${stageIndex}" />
					<input type="text" name="name" value="${stage.name}" />
					<button class="enter" type="submit">&{'common.change'}</button>
				</td>
			</tr>
		</table>
	</form>

	%{
	i = 1;
	for (group in stage.targetGroups) {
	}%
	<form action="@{Stages.deleteTargetGroup()}" method="POST">
		<table>
			<tr>
				<th style="text-align: left">
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="stageID" value="${stage.id}" />
					<input type="hidden" name="stageIndex" value="${stageIndex}" />
					<input type="hidden" name="targetGroupID" value="${group.id}" />
					MÃ¥lgrupp ${i++}
					<button class="delete" type="submit">&{'common.delete'}</button>
				</th>
			</tr>
		</table>
	</form>

	<table>
		<tr>
			<th style="text-align: left" />
			<th style="text-align: left">
				&{'common.type'}
			</th>
			<th style="text-align: left">
				&{'common.colour'}
			</th>
			<th style="text-align: left">
				&{'target.scoreable'}
			</th>
		</tr>
		%{
		j = 1;
		for (target in group.targets) {
		}%
		<tr>
			<td style="text-align: left">
				${j}
			</td>
			<td style="text-align: left">
				<select form="updateTarget_${target.id}" name="modelID">
					%{
					for (targetModel in targetModels) {
					}%
					<option value="${targetModel.id}" #{if (targetModel.id == target.getModelID())}selected#{/if}>${targetModel.getModel()}</option>
					%{
					}
					}%
				</select>
			</td>
			<td style="text-align: left">
			</td>
			<td style="text-align: left">
				<form id="updateTarget_${target.id}" method="POST">
					<input type="checkbox" name="hasPoints" #{if (target.hasPoints)}checked#{/if} />
					       <input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="stageID" value="${stage.id}" />
					<input type="hidden" name="stageIndex" value="${stageIndex}" />
					<input type="hidden" name="targetGroupID" value="${group.id}" />
					<input type="hidden" name="targetID" value="${target.id}" />
					<button class="enter" type="submit" formaction="@{Stages.updateTarget()}" #{if (request.headers.get("user-agent").toString().contains("MSIE"))}onClick='document.getElementById("updateTarget_${target.id}").action="@{Stages.updateTarget()}"'#{/if}>&{'common.update'}</button>
					<button class="delete" type="submit" formaction="@{Stages.deleteTarget()}" #{if (request.headers.get("user-agent").toString().contains("MSIE"))}onClick='document.getElementById("updateTarget_${target.id}").action="@{Stages.deleteTarget()}"'#{/if}>&{'common.delete'}</button>
				</form>
			</td>
		</tr>
		%{
		j++;
		}
		}%
		<tr>
			<td style="text-align: left">
			</td>
			<td style="text-align: left">
			</td>
			<td style="text-align: left">
			</td>
			<td style="text-align: left">
				<form action="@{Stages.addTarget()}" method="POST">
					<input type="checkbox" name="hasPoints" />
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="stageID" value="${stage.id}" />
					<input type="hidden" name="stageIndex" value="${stageIndex}" />
					<input type="hidden" name="targetGroupID" value="${group.id}" />
					<button class="enter" type="submit">&{'target.new'}</button>
				</form>
			</td>
		</tr>
	</table>
	%{
	}
	}%

	<table>
		<tr>
			<td style="text-align: left">
				<form action="@{Stages.addTargetGroup()}" method="POST">
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="stageID" value="${stage.id}" />
					<input type="hidden" name="stageIndex" value="${stageIndex}" />
					<button class="enter" type="submit">&{'targetgroup.new'}</button>
				</form>
			</td>
			<td style="text-align: left">
				<form action="@{Competitions.edit()}" method="POST">
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<button class="enter" type="submit">&{'competitions.return'}</button>
				</form>
			</td>
		</tr>
	</table>
</div>