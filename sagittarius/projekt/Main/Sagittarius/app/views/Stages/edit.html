#{extends "main.html" /}
#{set title: "${competition.name}, station ${stageIndex}" /}
%{
int i = 1;
int j = 1;
%}
<div>
	<h2>${competition.name}, station ${stageIndex}</h2>
	<form action="@{Stages.update}" method="POST">
		<table>
			<tr>
				<td>
					<input type="text" name="name" value="${stage.name}" />
					<input class="enter" type="submit" value="Ändra" />
				</td>
			</tr>
		</table>
	</form>

	%{
	i = 1;
	for (group in stage.targetGroups) {
	}%
	<form action="@{Stages.deleteTargetGroup()}" method="POST">
		<table>
			<tr>
				<th style="text-align: left">
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="stageID" value="${stage.id}" />
					<input type="hidden" name="stageIndex" value="${stageIndex}" />
					<input type="hidden" name="targetGroupID" value="${group.id}" />
					Målgrupp ${i++}
					<input class="delete" type="submit" value="Ta bort" />
				</th>
			</tr>
		</table>
	</form>

	<form action="@{Stages.updateTargetGroup()}" method="POST">
		<table>
			<tr>
				<th style="text-align: left">
					Figur
				</th>
				<th style="text-align: left">
					Typ
				</th>
				<th style="text-align: left">
					Färg
				</th>
				<th style="text-align: center">
					Poängmål
				</th>
			</tr>
			<input type="hidden" name="competitionID" value="${competition.id}" />
			<input type="hidden" name="stageID" value="${stage.id}" />
			<input type="hidden" name="stageIndex" value="${stageIndex}" />
			<input type="hidden" name="targetGroupID" value="${group.id}" />
			%{
			j = 1;
			String checked = "";
			for (target in group.targets) {
			if (target.hasPoints) {
			checked = "checked";
			}
			}%
			<input type="hidden" name="targets[${j}].id" value="${target.id}" />
			<tr>
				<td style="text-align: left">
					${j}
				</td>
				<td style="text-align: left">
					<input type="hidden" name="targets[${j}].model" value="${target.model}" />
					${target.model}
				</td>
				<td style="text-align: left">
				</td>
				<td style="text-align: center">
					<input type="checkbox" ${checked} name="targets[${j}].checked" />
				</td>
			</tr>
			%{
			j++;
			}
			}%
		</table>
		<input class="enter" type="submit" value="Uppdatera" />
	</form>
	%{
	}
	}%

	<form action="@{Stages.addTargetGroup()}" method="POST">
		<table>
			<tr>
				<td style="text-align: left">
					<input type="hidden" name="competitionID" value="${competition.id}" />
					<input type="hidden" name="stageID" value="${stage.id}" />
					<input type="hidden" name="stageIndex" value="${stageIndex}" />
					<input class="enter" type="submit" value="Ny målgrupp" />
				</td>
			</tr>
		</table>
	</form>
</div>